import mysql.connector
from dotenv import load_dotenv
import os
from datetime import date

# ğŸŒ± Load environment variables
load_dotenv()

# âœ… Connect to MySQL
conn = mysql.connector.connect(
    host=os.getenv("DB_HOST"),
    user=os.getenv("DB_USER"),
    password=os.getenv("DB_PASSWORD"),
    database=os.getenv("DB_NAME")
)
cursor = conn.cursor()

# ğŸš€ User Menu
print("\nğŸ“˜ Smart Expense Tracker")
print("1. Add Expense")
print("2. View All Expenses")
print("3. View Todayâ€™s Expenses")
print("4. View by Category")
print("5. View Total Spent")
print("6. View Category-wise Totals")
print("7. Delete Expense by ID")

choice = input("ğŸ‘‰ Enter your choice (1â€“7): ")

if choice == "1":
    category = input("Enter expense category (e.g., Food, Travel): ")
    amount = float(input("Enter amount spent: â‚¹ "))
    note = input("Enter a note (e.g., Lunch, Bus): ").strip() or "No note"

    cursor.execute(
        "INSERT INTO expenses (category, amount, note, expense_date) VALUES (%s, %s, %s, %s)",
        (category, amount, note, date.today())
    )
    conn.commit()
    print("âœ… Expense saved successfully!")

elif choice == "2":
    cursor.execute("SELECT id, amount, category, note, expense_date FROM expenses")
    results = cursor.fetchall()
    print("\nğŸ“‹ All Expenses:")
    for row in results:
        expense_id, amount, category, note, expense_date = row
        print(f"ID: {expense_id} | â‚¹{amount} | {category} - {note} | Date: {expense_date}")

elif choice == "3":
    today = date.today()
    cursor.execute("SELECT id, amount, category, note FROM expenses WHERE expense_date = %s", (today,))
    results = cursor.fetchall()
    print(f"\nğŸ“† Expenses on {today}:")
    for row in results:
        expense_id, amount, category, note = row
        print(f"ID: {expense_id} | â‚¹{amount} | {category} - {note}")

elif choice == "4":
    search = input("Enter category to view: ")
    cursor.execute("SELECT id, amount, note, expense_date FROM expenses WHERE category = %s", (search,))
    results = cursor.fetchall()
    print(f"\nğŸ” Expenses in category: {search}")
    for row in results:
        expense_id, amount, note, expense_date = row
        print(f"ID: {expense_id} | â‚¹{amount} | {note} | Date: {expense_date}")

elif choice == "5":
    cursor.execute("SELECT SUM(amount) FROM expenses")
    total = cursor.fetchone()[0]
    print(f"\nğŸ’° Total Spent: â‚¹{total if total else 0}")

elif choice == "6":
    cursor.execute("SELECT category, SUM(amount) FROM expenses GROUP BY category")
    results = cursor.fetchall()
    print("\nğŸ“Š Category-wise Total:")
    for category, total in results:
        print(f"{category}: â‚¹{total}")

elif choice == "7":
    delete_id = input("Enter Expense ID to delete: ")
    cursor.execute("DELETE FROM expenses WHERE id = %s", (delete_id,))
    conn.commit()
    if cursor.rowcount > 0:
        print(f"ğŸ—‘ï¸ Expense ID {delete_id} deleted successfully.")
    else:
        print("âŒ No expense found with that ID.")

else:
    print("âŒ Invalid choice. Please try again.")

# âœ… Always close the connection
conn.close()
